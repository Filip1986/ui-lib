<div
  class="reset-password-3-container min-h-screen flex items-center justify-center p-4"
  data-testid="reset-password-3-container"
  >
  <div
    class="reset-password-3-wrapper max-w-4xl w-full flex flex-col md:flex-row overflow-hidden shadow-xl rounded-xl"
    data-testid="reset-password-3-wrapper"
    >
    <!-- Left side decorative panel -->
    <div
      class="bg-gradient-to-br from-primary-600 to-primary-900 text-white p-8 md:w-2/5 flex flex-col justify-between"
      data-testid="reset-password-3-left-panel"
      >
      <div data-testid="reset-password-3-left-header">
        <h1 class="text-3xl font-bold mb-4" data-testid="reset-password-3-left-title">
          Password Reset
        </h1>
        <p class="text-primary-100 mb-6" data-testid="reset-password-3-left-subtitle">
          Create a new password to secure your account.
        </p>
      </div>

      <div class="hidden md:block" data-testid="reset-password-3-left-graphic">
        <svg
          class="w-full h-auto"
          fill="none"
          viewBox="0 0 900 600"
          xmlns="http://www.w3.org/2000/svg"
          >
          <path
            d="M0 549.5L21.5 546.2C43 542.8 86 536.2 129.2 534.5C172.3 532.8 215.7 536.2 258.8 545.3C302 554.5 345 569.5 388.2 564.3C431.3 559.2 474.7 533.8 517.8 528.3C561 522.8 604 537.2 647.2 539.5C690.3 541.8 733.7 532.2 776.8 530.7C820 529.2 863 535.8 884.5 539.2L906 542.5V601H884.5C863 601 820 601 776.8 601C733.7 601 690.3 601 647.2 601C604 601 561 601 517.8 601C474.7 601 431.3 601 388.2 601C345 601 302 601 258.8 601C215.7 601 172.3 601 129.2 601C86 601 43 601 21.5 601H0V549.5Z"
            fill="rgba(255,255,255,0.2)"
            />
          <circle cx="776.5" cy="222.5" fill="rgba(255,255,255,0.1)" r="38.5" />
          <circle cx="116.5" cy="167.5" fill="rgba(255,255,255,0.1)" r="24.5" />
          <circle cx="446.5" cy="367.5" fill="rgba(255,255,255,0.1)" r="48.5" />
        </svg>
      </div>
    </div>

    <!-- Right side form panel -->
    <div class="bg-white p-8 md:w-3/5" data-testid="reset-password-3-right-panel">
      @if (!resetSuccessful() && !tokenError()) {
        <div class="text-center md:text-left mb-8" data-testid="reset-password-3-right-header">
          <h2 class="text-2xl font-bold text-gray-800" data-testid="reset-password-3-right-title">
            {{ title }}
          </h2>
          <p class="text-gray-600 mt-1" data-testid="reset-password-3-right-subtitle">
            Create a new password to access your account
          </p>
        </div>
        <form
          (ngSubmit)="onSubmit()"
          [formGroup]="resetPasswordForm"
          class="space-y-6"
          data-testid="reset-password-3-form"
          >
          <!-- Password field -->
          <div data-testid="reset-password-3-password-field">
            <label class="block text-gray-700 font-medium mb-2" for="password">New Password</label>
            <div class="relative">
              <span
                class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500"
                >
                <i class="pi pi-lock"></i>
              </span>
              <input
                (input)="checkPasswordStrength($event)"
                [ngClass]="{'ng-invalid ng-dirty': submitted && password?.errors}"
                [type]="showPassword() ? 'text' : 'password'"
                class="w-full pl-10 pr-10"
                data-testid="reset-password-3-password-input"
                formControlName="password"
                id="password"
                pInputText
                placeholder="Create a new password (min. 6 characters)"
                />
              <button
                (click)="togglePasswordVisibility()"
                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500"
                data-testid="reset-password-3-toggle-password"
                type="button"
                >
                <i [ngClass]="showPassword() ? 'pi-eye-slash' : 'pi-eye'" class="pi"></i>
              </button>
            </div>
            @if (submitted && password?.errors) {
              <small
                class="p-error block mt-1"
                data-testid="reset-password-3-password-error"
                >
                @if (password?.errors?.['required']) {
                  <span>Password is required</span>
                }
                @if (password?.errors?.['minlength']) {
                  <span
                    >Password must be at least 6 characters</span
                    >
                  }
                </small>
              }
              <!-- Password strength indicator -->
              @if (features.showPasswordStrength && password?.value) {
                <div
                  class="mt-2"
                  data-testid="reset-password-3-password-strength"
                  >
                  <div class="w-full bg-gray-200 rounded-full h-1.5">
                    <div
                      [style.background-color]="getPasswordStrengthColor()"
                      [style.width]="(passwordStrength() * 20) + '%'"
                      class="h-1.5 rounded-full transition-all duration-300"
                      data-testid="reset-password-3-strength-bar"
                    ></div>
                  </div>
                  <div class="flex justify-between mt-1">
                    <span
                      [style.color]="getPasswordStrengthColor()"
                      class="text-xs"
                      data-testid="reset-password-3-strength-label"
                      >
                      {{ getPasswordStrengthLabel() }}
                    </span>
                    <span class="text-xs text-gray-500" data-testid="reset-password-3-strength-score">
                      {{ passwordStrength() }}/5
                    </span>
                  </div>
                </div>
              }
            </div>
            <!-- Confirm password field -->
            <div data-testid="reset-password-3-confirm-password-field">
              <label class="block text-gray-700 font-medium mb-2" for="confirmPassword"
                >Confirm Password</label
                >
                <div class="relative">
                  <span
                    class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500"
                    >
                    <i class="pi pi-lock-open"></i>
                  </span>
                  <input
                    [ngClass]="{'ng-invalid ng-dirty': submitted && confirmPassword?.errors || resetPasswordForm.errors?.['mismatch']}"
                    class="w-full pl-10"
                    data-testid="reset-password-3-confirm-password-input"
                    formControlName="confirmPassword"
                    id="confirmPassword"
                    pInputText
                    placeholder="Confirm your new password"
                    type="password"
                    />
                </div>
                @if (submitted && (confirmPassword?.errors || resetPasswordForm.errors?.['mismatch'])) {
                  <small
                    class="p-error block mt-1"
                    data-testid="reset-password-3-confirm-password-error"
                    >
                    @if (confirmPassword?.errors?.['required']) {
                      <span
                        >Please confirm your password</span
                        >
                      }
                      @if (resetPasswordForm.errors?.['mismatch']) {
                        <span>Passwords do not match</span>
                      }
                    </small>
                  }
                </div>
                <!-- Error message if provided -->
                @if (resetError) {
                  <div class="p-error mt-2" data-testid="reset-password-3-error">
                    {{ resetError }}
                  </div>
                }
                <!-- Submit button -->
                <button
                  [disabled]="resetPasswordForm.invalid || isSubmitting"
                  [loading]="isSubmitting()"
                  aria-label="Reset Password"
                  class="w-full p-3 text-center"
                  data-testid="reset-password-3-submit-button"
                  icon="pi pi-check"
                  iconPos="right"
                  label="Reset Password"
                  pButton
                  pRipple
                  type="submit"
                ></button>
              </form>
            }

            @if (tokenError()) {
              <div
                class="flex flex-col items-center justify-center py-8"
                data-testid="reset-password-3-token-error"
                >
                <div class="w-20 h-20 rounded-full bg-yellow-100 flex items-center justify-center mb-6">
                  <i class="pi pi-exclamation-triangle text-yellow-500 text-4xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Invalid Link</h3>
                <p class="text-gray-600 text-center mb-8 max-w-sm">
                  This password reset link is invalid or has expired. Please request a new link to reset
                  your password.
                </p>
                <button
                  (click)="navigateToForgotPassword()"
                  aria-label="Request New Link"
                  class="w-full md:w-2/3"
                  data-testid="reset-password-3-new-link-button"
                  label="Request New Link"
                  pButton
                  pRipple
                  type="button"
                ></button>
              </div>
            }

            @if (resetSuccessful()) {
              <div
                class="flex flex-col items-center justify-center py-8"
                data-testid="reset-password-3-success"
                >
                <div class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mb-6">
                  <i class="pi pi-check-circle text-green-500 text-4xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Password Updated</h3>
                <p class="text-gray-600 text-center mb-8 max-w-sm">
                  Your password has been successfully reset. You can now log in with your new password.
                </p>
                <button
                  (click)="navigateToLogin()"
                  aria-label="Go to Login"
                  class="w-full md:w-2/3"
                  data-testid="reset-password-3-login-button"
                  label="Go to Login"
                  pButton
                  pRipple
                  type="button"
                ></button>
              </div>
            }
          </div>
        </div>
      </div>
      <p-toast></p-toast>
