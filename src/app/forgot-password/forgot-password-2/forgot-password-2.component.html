<div
  class="forgot-password-2-container flex flex-col justify-center min-h-screen p-4"
  data-testid="forgot-password-2-container"
  >
  <div
    class="forgot-password-2-form-container mx-auto w-full max-w-sm"
    data-testid="forgot-password-2-form-container"
    >
    <div class="text-center mb-8" data-testid="forgot-password-2-header">
      <h1 class="text-3xl font-bold" data-testid="forgot-password-2-title">{{ title }}</h1>
      <p class="mt-2" data-testid="forgot-password-2-subtitle">Reset your account password</p>
    </div>

    @if (!resetLinkSent()) {
      <p class="mb-6 text-center" data-testid="forgot-password-2-instructions">
        Enter your email address below and we'll send you a link to reset your password.
      </p>
      <form
        (ngSubmit)="onSubmit()"
        [formGroup]="forgotPasswordForm"
        class="space-y-4"
        data-testid="forgot-password-2-form"
        >
        <div data-testid="forgot-password-2-email-field">
          <lib-input-text
            [config]="emailConfig"
            [errorMessage]="submitted && email?.errors ?
              (email?.errors?.['required'] ? 'Email is required' :
               email?.errors?.['email'] ? 'Please enter a valid email address' : '') : ''"
            data-testid="forgot-password-2-email-input"
            formControlName="email"
            />
        </div>
        <!-- Error message if provided -->
        @if (forgotPasswordError) {
          <div
            class="text-red-500 text-sm mt-2"
            data-testid="forgot-password-2-error"
            >
            {{ forgotPasswordError }}
          </div>
        }
        <button
          [disabled]="forgotPasswordForm.invalid || isSubmitting"
          [loading]="isSubmitting"
          aria-label="Send Reset Link"
          class="w-full mt-4"
          data-testid="forgot-password-2-submit-button"
          label="Send Reset Link"
          pButton
          type="submit"
        ></button>
      </form>
      @if (features.showLoginLink) {
        <div
          class="text-center text-sm mt-6"
          data-testid="forgot-password-2-login-link-container"
          >
          <span>Remembered your password?</span>
          <a
            (click)="navigateToLogin()"
            (keydown.enter)="navigateToLogin()"
            class="text-primary-600 hover:underline cursor-pointer ml-1"
            data-testid="forgot-password-2-login-link"
            tabindex="0"
            >
            Back to login
          </a>
        </div>
      }
    }

    @if (resetLinkSent()) {
      <div class="text-center py-8" data-testid="forgot-password-2-success">
        <div class="inline-block p-4 rounded-full mb-4">
          <i class="pi pi-check-circle text-green-500 text-4xl"></i>
        </div>
        <h3 class="text-xl font-semibold mb-3">Email Sent</h3>
        <p class="mb-6">
          If we found an account matching that email address, we've sent a password reset link.
          Please check your inbox and spam folder.
        </p>
        <button
          (click)="navigateToLogin()"
          aria-label="Back to Login"
          class="w-full"
          data-testid="forgot-password-2-back-button"
          label="Return to Login"
          pButton
          type="button"
        ></button>
      </div>
    }
  </div>
</div>
<p-toast></p-toast>
