<div
  class="registration-3-container min-h-screen flex items-center justify-center p-4"
  data-testid="registration-3-container"
  >
  <div
    class="registration-3-wrapper max-w-4xl w-full flex flex-col md:flex-row overflow-hidden"
    data-testid="registration-3-wrapper"
    >
    <!-- Left side decorative panel -->
    <div
      class="bg-gradient-to-br from-primary-600 to-primary-800 text-white p-8 md:w-2/5 flex flex-col justify-between"
      data-testid="registration-3-left-panel"
      >
      <div data-testid="registration-3-left-header">
        <h1 class="text-3xl font-bold mb-4" data-testid="registration-3-left-title">{{ title }}</h1>
        <p class="text-primary-100 mb-6" data-testid="registration-3-left-subtitle">
          Join our community and start your journey with us today.
        </p>
      </div>

      <div class="hidden md:block" data-testid="registration-3-left-graphic">
        <svg
          class="w-full h-auto"
          fill="none"
          viewBox="0 0 900 600"
          xmlns="http://www.w3.org/2000/svg"
          >
          <path
            d="M0 549.5L21.5 546.2C43 542.8 86 536.2 129.2 534.5C172.3 532.8 215.7 536.2 258.8 545.3C302 554.5 345 569.5 388.2 564.3C431.3 559.2 474.7 533.8 517.8 528.3C561 522.8 604 537.2 647.2 539.5C690.3 541.8 733.7 532.2 776.8 530.7C820 529.2 863 535.8 884.5 539.2L906 542.5V601H884.5C863 601 820 601 776.8 601C733.7 601 690.3 601 647.2 601C604 601 561 601 517.8 601C474.7 601 431.3 601 388.2 601C345 601 302 601 258.8 601C215.7 601 172.3 601 129.2 601C86 601 43 601 21.5 601H0V549.5Z"
            fill="rgba(255,255,255,0.2)"
            />
          <circle cx="776.5" cy="222.5" fill="rgba(255,255,255,0.1)" r="38.5" />
          <circle cx="116.5" cy="167.5" fill="rgba(255,255,255,0.1)" r="24.5" />
          <circle cx="446.5" cy="367.5" fill="rgba(255,255,255,0.1)" r="48.5" />
        </svg>
      </div>
    </div>

    <!-- Right side form panel -->
    <div class="bg-white p-8 md:w-3/5" data-testid="registration-3-right-panel">
      <div class="text-center md:text-left mb-6" data-testid="registration-3-right-header">
        <h2 class="text-2xl font-bold" data-testid="registration-3-right-title">Get Started</h2>
        <p class="text-gray-600 mt-1" data-testid="registration-3-right-subtitle">
          Create your account in just a few steps
        </p>
      </div>

      <form
        (ngSubmit)="onSubmit()"
        [formGroup]="registrationForm"
        class="space-y-5"
        data-testid="registration-3-form"
        >
        <!-- Username field -->
        <div data-testid="registration-3-username-field">
          <lib-input-text
            [config]="usernameConfig"
            [errorMessage]="submitted && username?.errors ?
      (username?.errors?.['required'] ? 'Username is required' :
       username?.errors?.['minlength'] ? 'Username must be at least 3 characters' :
       username?.errors?.['maxlength'] ? 'Username cannot exceed 30 characters' : '') : ''"
            [required]="true"
            data-testid="registration-3-username-input"
            formControlName="username"
            />
        </div>

        <!-- Email field -->
        <div data-testid="registration-3-email-field">
          <lib-input-text
            [config]="emailConfig"
            [errorMessage]="submitted && email?.errors ?
      (email?.errors?.['required'] ? 'Email is required' :
       email?.errors?.['email'] ? 'Please enter a valid email address' : '') : ''"
            [required]="true"
            data-testid="registration-3-email-input"
            formControlName="email"
            />
        </div>

        <!-- Password field -->
        <div data-testid="registration-3-password-field">
          <lib-input-text
            (iconClick)="togglePasswordVisibility()"
            (input)="checkPasswordStrength($event)"
            [config]="passwordConfig"
            [errorMessage]="submitted && password?.errors ?
      (password?.errors?.['required'] ? 'Password is required' :
       password?.errors?.['minlength'] ? 'Password must be at least 6 characters' : '') : ''"
            [iconPosition]="IconPosition.RIGHT"
            [icon]="showPassword() ? 'pi pi-eye-slash' : 'pi pi-eye'"
            [required]="true"
            [type]="showPassword() ? InputTextType.TEXT : InputTextType.PASSWORD"
            data-testid="registration-3-password-input"
            formControlName="password"
            />

          <!-- Password strength indicator -->
          @if (features.showPasswordStrength && password?.value) {
            <div
              class="mt-2"
              data-testid="registration-3-password-strength"
              >
              <div class="w-full rounded-full h-1.5">
                <div
                  [style.background-color]="getPasswordStrengthColor()"
                  [style.width]="(passwordStrength() * 20) + '%'"
                  class="h-1.5 rounded-full transition-all duration-300"
                  data-testid="registration-3-strength-bar"
                ></div>
              </div>
              <div class="flex justify-between mt-1">
                <span
                  [style.color]="getPasswordStrengthColor()"
                  class="text-xs"
                  data-testid="registration-3-strength-label"
                  >
                  {{ getPasswordStrengthLabel() }}
                </span>
                <span class="text-xs text-gray-500" data-testid="registration-3-strength-score">
                  {{ passwordStrength() }}/5
                </span>
              </div>
            </div>
          }
        </div>

        <!-- Confirm password field -->
        <div data-testid="registration-3-confirm-password-field">
          <lib-input-text
            [config]="confirmPasswordConfig"
            [errorMessage]="submitted && (confirmPassword?.errors || registrationForm.errors?.['mismatch']) ?
      (confirmPassword?.errors?.['required'] ? 'Please confirm your password' :
       registrationForm.errors?.['mismatch'] ? 'Passwords do not match' : '') : ''"
            [required]="true"
            data-testid="registration-3-confirm-password-input"
            formControlName="confirmPassword"
            />
        </div>

        <!-- Terms and conditions -->
        @if (features.showTermsLinks) {
          <div class="pt-2" data-testid="registration-3-terms-field">
            <div class="flex items-start">
              <p-checkbox
                [binary]="true"
                class="mt-0.5 mr-2"
                data-testid="registration-3-terms-checkbox"
                formControlName="acceptTerms"
                inputId="acceptTerms"
                />
              <label class="text-gray-700 text-sm" for="acceptTerms">
                By creating an account, I agree to the
                <a
                  class="text-primary-600 hover:underline"
                  data-testid="registration-3-terms-link"
                  href="#"
                  >Terms of Service</a
                  >
                  and
                  <a
                    class="text-primary-600 hover:underline"
                    data-testid="registration-3-privacy-link"
                    href="#"
                    >Privacy Policy</a
                    >.
                  </label>
                </div>
                @if (submitted && acceptTerms?.errors?.['required']) {
                  <small
                    class="p-error block mt-1"
                    data-testid="registration-3-terms-error"
                    >
                    You must accept the terms and conditions
                  </small>
                }
              </div>
            }

            <!-- Registration Error Message -->
            @if (registrationError) {
              <div class="mt-4" data-testid="registration-3-error">
                <p class="text-red-500 text-sm">{{ registrationError }}</p>
              </div>
            }

            <!-- Submit button -->
            <button
              [disabled]="registrationForm.invalid || isSubmitting"
              [loading]="isSubmitting"
              aria-label="Submit Registration Form"
              class="w-full p-3 mt-4"
              data-testid="registration-3-submit-button"
              icon="pi pi-user-plus"
              iconPos="right"
              label="Create Account"
              pButton
              pRipple
              type="submit"
            ></button>

            <!-- Login link -->
            @if (features.showLoginLink) {
              <div
                class="text-center text-sm text-gray-600 mt-4"
                data-testid="registration-3-login-section"
                >
                Already have an account?
                <a
                  (click)="navigateToLogin()"
                  (keydown.enter)="navigateToLogin()"
                  class="text-primary-600 hover:text-primary-800 hover:underline cursor-pointer font-medium ml-1"
                  data-testid="registration-3-login-link"
                  tabindex="0"
                  >
                  Sign in here
                </a>
              </div>
            }
          </form>
        </div>
      </div>
    </div>
